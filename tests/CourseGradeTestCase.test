<?php

require_once(drupal_get_path('module', 'course') . '/tests/CourseTestCase.test');

/**
 * Tests for Course enrollment
 */
class CourseGradeTestCase extends CourseTestCase {

  public static function getInfo() {
    // Note that getInfo() strings are not translated with t().
    return array(
      'name' => 'Course grading',
      'description' => 'Ensure that Course grading functions normally.',
      'group' => 'Course',
    );
  }

  public function testCourseFinalGrade() {
    $courseNode = $this->createCourseNode();

    // Create a graded course object.
    $co1 = $this->createGradedCourseObject($courseNode);

    // Reload the course from DB.
    $course = course_get_course($courseNode);
    $courseObjects = $course->getObjects();
    $co1 = $courseObjects[0];

    // Set grade result.
    $co1->getFulfillment()->setOption('grade_result', 80);

    // Track object not included in final grade.
    $co1->setOption('grade_include', FALSE);
    $co1->getCourse()->getTracker()->track();
    $this->assertNotEqual($co1->getCourse()->getTracker()->getOption('grade_result'), 80, 'Course grade was not given from course object');

    // Track object included in final grade.
    $co1->setOption('grade_include', TRUE);
    $co1->getCourse()->getTracker()->track();
    $this->assertEqual($co1->getCourse()->getTracker()->getOption('grade_result'), 80, 'Course grade was given from course object');
  }

}
