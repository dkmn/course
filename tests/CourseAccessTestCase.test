<?php

require_once(drupal_get_path('module', 'course') . '/tests/CourseTestCase.test');

/**
 * Tests for conditional event-based access to course objects.
 */
class CourseAccessTestCase extends CourseTestCase {

  public static function getInfo() {
    // Note that getInfo() strings are not translated with t().
    return array(
      'name' => 'Course access',
      'description' => 'Ensure that Course access control functions properly.',
      'group' => 'Course',
    );
  }

  function testDurationExpiration() {
    global $user;
    $courseNode = $this->createCourseNode();
    $courseNode->course['duration'] = 30;
    node_save($courseNode);
    course_enrol($courseNode, $user);

    // Expire the duration.
    $enrol = course_enrolment_load($courseNode, $user);
    $enrol->enrol_end = 1;
    course_enrolment_save($enrol);
    $result = course_take_course_access($courseNode, $user, TRUE);
    $this->assertFalse($result['success'], 'User cannot access course with expired enrollment.');
  }

}
